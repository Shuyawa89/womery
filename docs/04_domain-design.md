# ドメイン設計書

## 概要

本ドキュメントは、Womeryのドメイン設計の過程と決定事項を記録する。

## 最終更新日

2024年12月18日

## ステータス

**設計中** - Bounded Context識別前

---

## 設計プロセスの記録

### Phase 1: 用語の確認と修正

要件定義で作成した用語集をレビューし、以下の修正を行った。

| 変更前 | 変更後 | 理由 |
|--------|--------|------|
| 勤務形態（WorkStyle） | 勤務場所（WorkLocation） | 「形態」より「場所」の方が実態に合っている |
| クイック入力（QuickCapture） | クイックメモ（QuickMemo） | 通常の詳細があるメモと区別するため |

### Phase 2: ドメイン理解のためのヒアリング

以下の質問を通じて、ドメインの理解を深めた。

#### Q1: ルーティンと日次スケジュールの関係

**結論:** ルーティンは「テンプレート」、日次スケジュールは「特定の日に適用された結果」

```
ルーティン（テンプレート）
  └── 出社用ルーティン
  └── 在宅用ルーティン
  └── 休日用ルーティン

日次スケジュール（特定の日の予定）
  └── 2024/12/19: 出社 → 出社用ルーティンを適用
  └── 2024/12/20: 在宅 → 在宅用ルーティンを適用
  └── 2024/12/21: 休日 → 休日用ルーティンを適用
```

#### Q2: 休日・祝日のルーティンについて

**結論:**
- 休日と祝日は同じルーティンで良い
- 土日・祝日は自動で「休日」と判定される
- 祝日の判定はカレンダー（日本の祝日）を使用

#### Q3: タスクとメモの違い

**結論:**

| 項目 | タスク | メモ |
|------|--------|------|
| 性質 | 具体的にやること決定済み | 将来やるかも、アイデア、気になったこと |
| 期日 | あり（設定されていることが多い） | なし |
| 実行 | する前提 | するとは限らない |

```
クイックメモ（とりあえず記録）
         ↓
       Inbox
         ↓
    ┌────┴────┐
    ↓         ↓
  タスク     メモ
```

#### Q4: 持ち物は勤務場所によって変わるか

**結論:** 変わる。共通の持ち物と、勤務場所固有の持ち物がある。

```
持ち物の分類:
- 共通: 財布、鍵など（どの勤務場所でも必要）
- 出社のみ: PC、社員証など
- 在宅のみ: （あれば）
- 休日のみ: （あれば）
```

---

## 現時点でのドメイン理解

### 勤務場所（WorkLocation）

```
┌─────────────────────────────────────────┐
│ WorkLocation（勤務場所）                 │
├─────────────────────────────────────────┤
│ - Office（出社）                         │
│ - Remote（在宅）                         │
│ - DayOff（休日）← 土日・祝日            │
└─────────────────────────────────────────┘

判定ロジック:
- 土日 → 自動で DayOff
- 祝日 → 自動で DayOff（日本の祝日カレンダー）
- 平日 → 前日にユーザーが Office or Remote を選択
```

### ルーティン

```
┌─────────────────────────────────────────┐
│ ルーティンテンプレート                   │
├─────────────────────────────────────────┤
│ - 出社用ルーティン                       │
│ - 在宅用ルーティン                       │
│ - 休日用ルーティン                       │
└─────────────────────────────────────────┘
         ↓ 勤務場所に応じて適用
┌─────────────────────────────────────────┐
│ 日次スケジュール（12/19）                │
├─────────────────────────────────────────┤
│ 勤務場所: 出社                           │
│ 適用ルーティン: 出社用ルーティン          │
└─────────────────────────────────────────┘
```

### Inbox・タスク・メモ

```
┌─────────────────────────────────────────┐
│ クイックメモ                             │
│ （最小限の入力で即座に記録）              │
└─────────────────────────────────────────┘
                    ↓
┌─────────────────────────────────────────┐
│ Inbox                                    │
│ （未整理のアイテムが蓄積される場所）      │
└─────────────────────────────────────────┘
                    ↓ 後から分類（任意）
        ┌───────────┴───────────┐
        ↓                       ↓
┌───────────────┐       ┌───────────────┐
│ タスク         │       │ メモ           │
├───────────────┤       ├───────────────┤
│ - 期日あり     │       │ - 期日なし     │
│ - 実行する前提 │       │ - 参照用       │
│ - 完了できる   │       │ - 実行不確定   │
└───────────────┘       └───────────────┘
```

### 持ち物

```
┌─────────────────────────────────────────┐
│ 持ち物マスタ                             │
├─────────────────────────────────────────┤
│ 財布     [共通]                          │
│ 鍵       [共通]                          │
│ PC       [出社のみ]                      │
│ 社員証   [出社のみ]                      │
│ ...                                      │
└─────────────────────────────────────────┘
         ↓ 勤務場所に応じてフィルタ
┌─────────────────────────────────────────┐
│ 日次チェック（12/19・出社）              │
├─────────────────────────────────────────┤
│ 財布   [共通]     → ✓                   │
│ 鍵     [共通]     → ✓                   │
│ PC     [出社のみ] → ✗                   │
│ 社員証 [出社のみ] → ✗                   │
└─────────────────────────────────────────┘

※ チェック状態は日次でリセットされる
```

---

## 用語集（ユビキタス言語）更新版

| 用語 | 英語 | 定義 |
|------|------|------|
| ルーティン | Routine | 毎日繰り返す一連の行動のテンプレート |
| ルーティン項目 | RoutineItem | ルーティンを構成する個々の行動（例：洗顔、朝食） |
| 勤務場所 | WorkLocation | 出社（Office）、在宅（Remote）、休日（DayOff）のいずれか |
| 日次スケジュール | DailySchedule | 特定の日付に対して適用されるルーティンと勤務場所の組み合わせ |
| 持ち物 | Belonging | 外出時に持っていくべき物品 |
| 持ち物チェック | BelongingCheck | 特定の日の持ち物確認状態 |
| クイックメモ | QuickMemo | 最小限の入力で即座に記録するメモ |
| Inbox | Inbox | 未整理のクイックメモが蓄積される場所 |
| タスク | Task | 具体的にやることが決定済みで、期日があり、実行する前提のもの |
| メモ | Memo | 将来やるかもしれないこと、アイデア、気になったことの記録 |
| タイムスロット | TimeSlot | 開始時刻と終了時刻で定義される時間枠 |

---

## 次のステップ

### 直近でやること

1. **Bounded Context（境界づけられたコンテキスト）の識別**
   - Womeryを意味のある単位に分割する
   - 各コンテキストの責務を明確にする

2. **Aggregate（集約）の設計**
   - データの整合性を保つ単位を決める
   - Aggregate Root を特定する

3. **Entity と Value Object の定義**
   - 識別子を持つもの（Entity）と値そのもの（Value Object）を区別
   - 各オブジェクトの属性を定義

### 将来やること

4. **Domain Service の識別**
   - Entity/VOに属さないビジネスロジックを抽出

5. **Repository インターフェースの定義**
   - 永続化の抽象化

6. **ドメインモデル図の作成**
   - 全体像を可視化

---

## 設計上の注意点（メモ）

### 「クイックメモ」と「Inbox」と「タスク/メモ」の関係

現状の理解では、以下のような流れになる。

1. ユーザーが「クイックメモ」機能で何かを記録
2. 記録されたものは「Inbox」に入る
3. 後から「タスク」または「メモ」に分類する（任意）

**設計上の問い:**
- 「Inbox」は独立したエンティティか？それとも「タスク/メモ」の状態（未分類状態）か？
- 分類しないままのものはずっと「Inbox」に残る？

→ Aggregate設計時に検討する

### 勤務場所と持ち物の関係

持ち物は「どの勤務場所で必要か」という属性を持つ。

**設計上の問い:**
- 1つの持ち物が複数の勤務場所に紐づく（例：共通）
- これは「多対多」の関係？それとも「フラグ」で表現？

→ Aggregate設計時に検討する

---

## 変更履歴

| 日付 | 変更内容 |
|------|----------|
| 2024/12/18 | 初版作成。用語修正、ドメイン理解のヒアリング結果を記録 |
